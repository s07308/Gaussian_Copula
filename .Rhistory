if(G_func1(y) == 0) return(0)
return(mean(T1.obs[X1.obs == 1] > y) / G_func1(y))
}
}
H11.hat <- function(x, y, X1.obs = X1, T1.obs = Y1) {
left <- H10.hat(x, y - 1e-3)
right <- H10.hat(x, y)
return(left - right)
}
## imputation
c.hat <- numeric(nrow(df.pair))
d.hat <- numeric(nrow(df.pair))
for(k in seq(1, nrow(df.pair))) {
if(df.pair[k, 1] > df.pair[k, 5]) {
## xi > xi'
if(df.pair[k, 2] > df.pair[k, 6]) {
## yi > yi'
H10.hat.i <- H10.hat(0, df.pair[k, 2])
H10.hat.ip <- H10.hat(0, df.pair[k, 6])
if(df.pair[k, 7] == 1) {
c.hat[k] <- 1
d.hat[k] <- 0
} else if(df.pair[k, 3] == 1 & df.pair[k, 7] == 0) {
d.hat[k] <- ifelse(H10.hat.ip == 0, 0, H10.hat.i / H10.hat.ip)
c.hat[k] <- 1 - d.hat[k]
} else {
t <- Y1[Y1 > df.pair[k, 2] & X1 == 1]
if(length(t) == 0) {
c.hat[k] <- 0
d.hat[k] <- 0
} else {
integral.c <- numeric(length(t))
integral.d <- numeric(length(t))
for(m in seq(1, length(t))) {
integral.c[m] <- (H10.hat.ip - H10.hat(0, t[m])) * H11.hat(1, t[m])
integral.d[m] <- H10.hat(0, t[m]) * H11.hat(1, t[m])
}
c.hat[k] <- sum(integral.c) / H10.hat(1, df.pair[k, 2]) / H10.hat.ip
d.hat[k] <- sum(integral.d) / H10.hat(1, df.pair[k, 2]) / H10.hat.ip
c.hat[k] <- ifelse(H10.hat.ip * H10.hat(1, df.pair[k, 2]) == 0, 0, c.hat[k])
d.hat[k] <- ifelse(H10.hat.ip * H10.hat(1, df.pair[k, 2]) == 0, 0, d.hat[k])
}
}
} else {
## yi < yi'
H10.hat.i <- H10.hat(1, df.pair[k, 2])
H10.hat.ip <- H10.hat(1, df.pair[k, 6])
if(df.pair[k, 3] == 1) {
c.hat[k] <- 0
d.hat[k] <- 1
} else if(df.pair[k, 3] == 0 & df.pair[k, 7] == 1) {
c.hat[k] <- ifelse(H10.hat.i == 0, 0, H10.hat.ip / H10.hat.i)
d.hat[k] <- 1 - c.hat[k]
} else {
s <- Y1[Y1 > df.pair[k, 6] & X1 == 0]
if(length(s) == 0) {
c.hat[k] <- 0
d.hat[k] <- 0
} else {
integral.c <- numeric(length(s))
integral.d <- numeric(length(s))
for(m in seq(1, length(s))) {
integral.c[m] <- H10.hat(1, s[m]) * H11.hat(0, s[m])
integral.d[m] <- (H10.hat.i - H10.hat(1, s[m])) * H11.hat(0, s[m])
}
c.hat[k] <- sum(integral.c) / H10.hat.i / H10.hat(0, df.pair[k, 6])
d.hat[k] <- sum(integral.d) / H10.hat.i / H10.hat(0, df.pair[k, 6])
c.hat[k] <- ifelse(H10.hat.i * H10.hat(0, df.pair[k, 6]) == 0, 0, c.hat[k])
d.hat[k] <- ifelse(H10.hat.i * H10.hat(0, df.pair[k, 6]) == 0, 0, d.hat[k])
}
}
}
}
if(df.pair[k, 1] < df.pair[k, 5]) {
## xi < xi'
if(df.pair[k, 2] > df.pair[k, 6]) {
## yi > yi'
H10.hat.i <- H10.hat(1, df.pair[k, 2])
H10.hat.ip <- H10.hat(1, df.pair[k, 6])
if(df.pair[k, 7] == 1) {
c.hat[k] <- 0
d.hat[k] <- 1
} else if(df.pair[k, 3] == 1 & df.pair[k, 7] == 0) {
c.hat[k] <- ifelse(H10.hat.ip == 0, 0, H10.hat.i / H10.hat.ip)
d.hat[k] <- 1 - c.hat[k]
} else {
t <- Y1[Y1 > df.pair[k, 2] & X1 == 0]
if(length(t) == 0) {
c.hat[k] <- 0
d.hat[k] <- 0
} else {
integral.c <- numeric(length(t))
integral.d <- numeric(length(t))
for(m in seq(1, length(t))) {
integral.c[m] <- H10.hat(1, t[m]) * H11.hat(0, t[m])
integral.d[m] <- (H10.hat.ip - H10.hat(1, t[m])) * H11.hat(0, t[m])
}
c.hat[k] <- sum(integral.c) / H10.hat(0, df.pair[k, 2]) / H10.hat.ip
d.hat[k] <- sum(integral.d) / H10.hat(0, df.pair[k, 2]) / H10.hat.ip
c.hat[k] <- ifelse(H10.hat.ip * H10.hat(0, df.pair[k, 2]) == 0, 0, c.hat[k])
d.hat[k] <- ifelse(H10.hat.ip * H10.hat(0, df.pair[k, 2]) == 0, 0, d.hat[k])
}
}
} else {
## yi < yi'
H10.hat.i <- H10.hat(0, df.pair[k, 2])
H10.hat.ip <- H10.hat(0, df.pair[k, 6])
if(df.pair[k, 3] == 1) {
c.hat[k] <- 1
d.hat[k] <- 0
} else if(df.pair[k, 3] == 0 & df.pair[k, 7] == 1) {
d.hat[k] <- ifelse(H10.hat.i == 0, 0, H10.hat.ip / H10.hat.i)
c.hat[k] <- 1 - d.hat[k]
} else {
s <- Y1[Y1 > df.pair[k, 6] & X1 == 1]
if(length(s) == 0) {
c.hat[k] <- 0
d.hat[k] <- 0
} else {
integral.c <- numeric(length(s))
integral.d <- numeric(length(s))
for(m in seq(1, length(s))) {
integral.c[m] <- (H10.hat.i - H10.hat(0, s[m])) * H11.hat(1, s[m])
integral.d[m] <- H10.hat(0, s[m]) * H11.hat(1, s[m])
}
c.hat[k] <- sum(integral.c) / H10.hat(1, df.pair[k, 6]) / H10.hat.i
d.hat[k] <- sum(integral.d) / H10.hat(1, df.pair[k, 6]) / H10.hat.i
c.hat[k] <- ifelse(H10.hat.i * H10.hat(1, df.pair[k, 6]) == 0, 0, c.hat[k])
d.hat[k] <- ifelse(H10.hat.i * H10.hat(1, df.pair[k, 6]) == 0, 0, d.hat[k])
}
}
}
}
if(is.na(c.hat[k]) | is.na(d.hat[k])) {
print(df.pair[k, ])
}
if(abs(c.hat[k]) > 1 | abs(d.hat[k]) > 1) {
# print(c(k, c.hat[k], d.hat[k]))
}
}
tau.imputed <- sum(c.hat) - sum(d.hat)
tau.true <- sum((df.pair[, 1] - df.pair[, 5]) * ifelse(df.pair[, 4] > df.pair[, 8], 1, -1))
c.true <- sum((df.pair[, 1] - df.pair[, 5]) * ifelse(df.pair[, 4] > df.pair[, 8], 1, -1) > 0)
d.true <- sum((df.pair[, 1] - df.pair[, 5]) * ifelse(df.pair[, 4] > df.pair[, 8], 1, -1) < 0)
n0 <- sum(X1 == 0)
n1 <- sum(X1 == 1)
logrank <- survdiff(Surv(time = Y1, event = delta) ~ X1)
gehan <- survdiff(Surv(time = Y1, event = delta) ~ X1, rho = 1)
gehan2 <- Gehan_func(Y1, delta, X1)
n1 <- sum(X1)
n0 <- size - n1
mu.1 <- n1 * (n1 + n0 + 1) * 0.5
sigma.1 <- sqrt(n1 * n0 * (n1 + n0 + 1) / 12)
wilcox <- (sum(rank(T1)[X1 == 1]) - mu.1) / sigma.1
return(list(bias = (tau.imputed - tau.true) / n0 / n1,
C.rate = mean(delta),
tau.true = tau.true / n0 / n1,
c.hat = sum(c.hat) / n0 / n1,
d.hat = sum(d.hat) / n0 / n1,
c.true = c.true / n0 / n1,
d.true = d.true / n0 / n1,
tau.hat = tau.imputed / n0 / n1,
logrank = logrank$chisq,
wilcox = wilcox ^ 2,
gehan = gehan$chisq,
gehan2 = gehan2))
}
C.rate <- 0.68
size <- 200
set.seed(20200630)
sim <- replicate(n = 500, expr = {
## generate (Y, delta, X), where X is binary and Y is lifetime with censoring
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
return(impute_binary_tau(Y1, delta, X1, T1))
})
hist(unlist(sim["bias", ]), xlab = NA)
par(mfrow = c(1, 5))
hist((unlist(sim["tau.hat", ]) / sd(unlist(sim["tau.hat", ]))) ^ 2,
main = "proposed",
xlab = "chisq",
freq = FALSE)
curve(dchisq(x, df = 1), from = 0, to = 50, add = TRUE)
hist(unlist(sim["logrank", ]), main = "logrank", xlab = "chisq", freq = FALSE)
curve(dchisq(x, df = 1), from = 0, to = 50, add = TRUE)
hist(unlist(sim["gehan", ]), main = "Gehan", xlab = "chisq", freq = FALSE)
curve(dchisq(x, df = 1), from = 0, to = 50, add = TRUE)
hist(unlist(sim["wilcox", ]), main = "Wilcoxon", xlab = "chisq", freq = FALSE)
curve(dchisq(x, df = 1), from = 0, to = 50, add = TRUE)
hist(unlist(sim["gehan2", ]), main = "Gehan2", xlab = "z", freq = FALSE)
curve(dnorm(x, mean = 0, sd = 1), from = -5, to = 5, add = TRUE)
mean(unlist(sim["bias", ]))
sd(unlist(sim["bias", ]))
mean(unlist(sim["tau.true", ]))
mean(unlist(sim["tau.hat", ]))
mean(unlist(sim["C.rate", ]))
proposed.ts <- (unlist(sim["tau.hat", ]) / sd(unlist(sim["tau.hat", ]))) ^ 2
mean(proposed.ts > qchisq(0.95, df = 1))
mean(unlist(sim["logrank", ]) > qchisq(0.95, df = 1))
mean(unlist(sim["gehan", ]) > qchisq(0.95, df = 1))
mean(unlist(sim["wilcox", ]) > qchisq(0.95, df = 1))
mean(abs(unlist(sim["gehan2", ])) > qnorm(0.975, mean = 0, sd = 1))
sd(proposed.ts > qchisq(0.95, df = 1))
sd(unlist(sim["logrank", ]) > qchisq(0.95, df = 1))
sd(unlist(sim["gehan", ]) > qchisq(0.95, df = 1))
sd(unlist(sim["wilcox", ]) > qchisq(0.95, df = 1))
sd(abs(unlist(sim["gehan2", ])) > qnorm(0.975, mean = 0, sd = 1))
C.rate <- 0.12
size <- 200
set.seed(20200630)
sim <- replicate(n = 500, expr = {
## generate (Y, delta, X), where X is binary and Y is lifetime with censoring
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T1 <- rweibull(n = size, shape = 2, scale = 1)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
return(impute_binary_tau(Y1, delta, X1, T1))
})
hist(unlist(sim["bias", ]), xlab = NA)
par(mfrow = c(1, 5))
hist((unlist(sim["tau.hat", ]) / sd(unlist(sim["tau.hat", ]))) ^ 2,
main = "proposed",
xlab = "chisq",
freq = FALSE)
curve(dchisq(x, df = 1), from = 0, to = 50, add = TRUE)
hist(unlist(sim["logrank", ]), main = "logrank", xlab = "chisq", freq = FALSE)
curve(dchisq(x, df = 1), from = 0, to = 50, add = TRUE)
hist(unlist(sim["gehan", ]), main = "Gehan", xlab = "chisq", freq = FALSE)
curve(dchisq(x, df = 1), from = 0, to = 50, add = TRUE)
hist(unlist(sim["wilcox", ]), main = "Wilcoxon", xlab = "chisq", freq = FALSE)
curve(dchisq(x, df = 1), from = 0, to = 50, add = TRUE)
hist(unlist(sim["gehan2", ]), main = "Gehan2", xlab = "z", freq = FALSE)
curve(dnorm(x, mean = 0, sd = 1), from = -5, to = 5, add = TRUE)
mean(unlist(sim["bias", ]))
sd(unlist(sim["bias", ]))
mean(unlist(sim["tau.true", ]))
mean(unlist(sim["tau.hat", ]))
mean(unlist(sim["C.rate", ]))
proposed.ts <- (unlist(sim["tau.hat", ]) / sd(unlist(sim["tau.hat", ]))) ^ 2
mean(proposed.ts > qchisq(0.95, df = 1))
mean(unlist(sim["logrank", ]) > qchisq(0.95, df = 1))
mean(unlist(sim["gehan", ]) > qchisq(0.95, df = 1))
mean(unlist(sim["wilcox", ]) > qchisq(0.95, df = 1))
mean(abs(unlist(sim["gehan2", ])) > qnorm(0.975, mean = 0, sd = 1))
sd(proposed.ts > qchisq(0.95, df = 1))
sd(unlist(sim["logrank", ]) > qchisq(0.95, df = 1))
sd(unlist(sim["gehan", ]) > qchisq(0.95, df = 1))
sd(unlist(sim["wilcox", ]) > qchisq(0.95, df = 1))
sd(abs(unlist(sim["gehan2", ])) > qnorm(0.975, mean = 0, sd = 1))
Gehan_func <- function(Y1, delta, X1) {
m <- sum(X1 == 1)
n <- sum(X1 == 0)
Gehan.score <- numeric(length(Y1))
for(i in seq(1, length(Y1))) {
Gehan.score[i] <- sum(Y1[i] > Y1 & (delta == 1)) - sum(Y1[i] < Y1 & (delta[i] == 1))
}
ts <- sum(Gehan.score[X1 == 1])
sigma2 <- sum(Gehan.score ^ 2) / (m + n)
v <- m * n * sigma2 / (m + n - 1)
return(list(z = ts / sqrt(v), score = Gehan.score))
}
MannWhitney_func <- function(Y1, delta, X1, T1) {
m <- sum(X1 == 1)
n <- sum(X1 == 0)
MW.score <- numeric(length(T1))
for(i in seq(1, length(T1))) {
MW.score[i] <- sum(T1[i] > T1) - sum(T1[i] < T1)
}
ts <- sum(MW.score[X1 == 1])
return(list(score = MW.score))
MannWhitney_func <- function(Y1, delta, X1, T1) {
m <- sum(X1 == 1)
n <- sum(X1 == 0)
MW.score <- numeric(length(T1))
for(i in seq(1, length(T1))) {
MW.score[i] <- sum(T1[i] > T1) - sum(T1[i] < T1)
}
ts <- sum(MW.score[X1 == 1])
return(list(score = MW.score))
}
sd
}
Gehan_func <- function(Y1, delta, X1) {
m <- sum(X1 == 1)
n <- sum(X1 == 0)
Gehan.score <- numeric(length(Y1))
for(i in seq(1, length(Y1))) {
Gehan.score[i] <- sum(Y1[i] > Y1 & (delta == 1)) - sum(Y1[i] < Y1 & (delta[i] == 1))
}
ts <- sum(Gehan.score[X1 == 1])
sigma2 <- sum(Gehan.score ^ 2) / (m + n)
v <- m * n * sigma2 / (m + n - 1)
return(list(z = ts / sqrt(v), score = Gehan.score))
}
MannWhitney_func <- function(Y1, delta, X1, T1) {
m <- sum(X1 == 1)
n <- sum(X1 == 0)
MW.score <- numeric(length(T1))
for(i in seq(1, length(T1))) {
MW.score[i] <- sum(T1[i] > T1) - sum(T1[i] < T1)
}
ts <- sum(MW.score[X1 == 1])
return(list(score = MW.score))
}
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
Gehan_func <- function(Y1, delta, X1) {
m <- sum(X1 == 1)
n <- sum(X1 == 0)
Gehan.score <- numeric(length(Y1))
for(i in seq(1, length(Y1))) {
Gehan.score[i] <- sum(Y1[i] > Y1 & (delta == 1)) - sum(Y1[i] < Y1 & (delta[i] == 1))
}
ts <- sum(Gehan.score[X1 == 1])
sigma2 <- sum(Gehan.score ^ 2) / (m + n)
v <- m * n * sigma2 / (m + n - 1)
return(list(z = ts / sqrt(v), score = Gehan.score))
}
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
MannWhitney_func <- function(Y1, delta, X1, T1) {
m <- sum(X1 == 1)
n <- sum(X1 == 0)
MW.score <- numeric(length(T1))
for(i in seq(1, length(T1))) {
MW.score[i] <- sum(T1[i] > T1) - sum(T1[i] < T1)
}
ts <- sum(MW.score[X1 == 1])
return(list(z = sum(ts), score = MW.score))
}
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
MannWhitney_func <- function(Y1, delta, X1, T1) {
m <- sum(X1 == 1)
n <- sum(X1 == 0)
MW.score <- numeric(length(T1))
for(i in seq(1, length(T1))) {
MW.score[i] <- sum(T1[i] > T1) - sum(T1[i] < T1)
}
ts <- sum(MW.score[X1 == 1])
sigma2 <- sum(MW.score ^ 2) / (m + n)
v <- m * n * sigma2 / (m + n - 1)
return(list(z = sum(ts) / sqrt(v), score = MW.score))
}
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
MannWhitney_func <- function(Y1, delta, X1, T1) {
m <- sum(X1 == 1)
n <- sum(X1 == 0)
MW.score <- numeric(length(T1))
for(i in seq(1, length(T1))) {
MW.score[i] <- sum(T1[i] > T1) - sum(T1[i] < T1)
}
ts <- sum(MW.score[X1 == 1])
sigma2 <- sum(MW.score ^ 2) / (m + n)
v <- m * n * sigma2 / (m + n - 1)
return(list(z = sum(ts) / sqrt(v), score = MW.score, tau = sum(ts) / m / n))
}
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
X1 <- rbinom(n = size, size = 1, prob = 0.5)
T11 <- rweibull(n = size, shape = 2, scale = 1.2)
T12 <- rweibull(n = size, shape = 0.5, scale = 2)
T1 <- ifelse(X1 == 1, T11, T12)
C <- rexp(n = size, rate = C.rate)
Y1 <- ifelse(T1 < C, T1, C)
delta <- ifelse(T1 < C, 1, 0)
Gehan_func(Y1, delta, X1)
MannWhitney_func(Y1, delta, X1, T1)
impute_binary_tau(Y1, delta, X1, T1)$tau.hat
